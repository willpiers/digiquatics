<% provide(:title, 'Sub Request') %>

<h1 class='cross_platform_header'>Sub Request</h1>

<div class='table-width-desktop'>

  <% if @sub_request.active? %>
    <ul class='pull-right'>
      <%= bootstrap_form_for @sub_request do |f| %>
        <%= f.hidden_field :active, value: false %>
        <%= f.hidden_field :sub_user_id, value: current_user.id %>
        <%= f.hidden_field :sub_first_name, value: current_user.first_name %>
        <%= f.hidden_field :sub_last_name, value: current_user.last_name %>
        <%= f.submit 'Accept', class: 'btn btn-success' %>
      <% end %>
    </ul>
  <% end %>

  <% if current_user.admin? && @sub_request.active == false && !@sub_request.processed_by_user_id %>
    <ul class='pull-right'>
      <%= bootstrap_form_for @sub_request do |f| %>
        <%= f.hidden_field :approved, value: false %>
        <%= f.hidden_field :processed_on, value: Time.now %>
        <%= f.hidden_field :processed_by_user_id, value: current_user.id %>
        <%= f.hidden_field :processed_by_first_name, value: current_user.first_name %>
        <%= f.hidden_field :processed_by_last_name, value: current_user.last_name %>
        <%= f.submit 'Deny', class: 'btn btn-danger' %>
      <% end %>
    </ul>
    <ul class='pull-right'>
      <%= bootstrap_form_for @sub_request do |f| %>
        <%= f.hidden_field :approved, value: true %>
        <%= f.hidden_field :processed_on, value: Time.now %>
        <%= f.hidden_field :processed_by_user_id, value: current_user.id %>
        <%= f.hidden_field :processed_by_first_name, value: current_user.first_name %>
        <%= f.hidden_field :processed_by_last_name, value: current_user.last_name %>
        <%= f.submit 'Approve', class: 'btn btn-success' %>
      <% end %>
    </ul>
  <% end %>

  <div class='pull-left'>
    <%= link_to ' Back', sub_requests_path , class: 'glyphicon glyphicon-arrow-left' %>
  </div>

  <table class='table table-bordered table-condensed'>
      <tr>
        <th id='fixtablewidth'>Location</th>
        <td><%= @sub_request.shift.location.name %></td>
      </tr>
      <tr>
        <th>Position</th>
        <td><%= @sub_request.shift.position.name %></td>
      </tr>
      <tr>
        <th>Shift Date</th>
        <td><%= @sub_request.shift.start_time.strftime('%-m/%-d/%Y') %></td>
      </tr>
      <tr>
        <th>Shift Time</th>
        <td>
          <%= "#{@sub_request.shift.start_time.strftime('%I:%M')}-
               #{@sub_request.shift.end_time.strftime('%I:%M%p')}" %>
        </td>
      </tr>
    <tr>
      <th>Requested By</th>
        <td>
            <%= link_to "#{@sub_request.shift.user.last_name},
                         #{@sub_request.shift.user.first_name}",
                         user_path(id: @sub_request.shift.user.id) %>
        </td>
    </tr>
    <% if @sub_request.active == false %>
      <% if @sub_request.approved == true %>
        <tr>
          <th>Employee Sub</th>
            <td>
                <%= link_to "#{@sub_request.sub_last_name},
                             #{@sub_request.sub_first_name}",
                             user_path(id: @sub_request.sub_user_id) %>
            </td>
        </tr>
      <% end %>
      <tr>
        <th>Status</th>
        <td class= <%=BooleanToWordsTimeOffCSS(@sub_request.approved)%>>
          <%= BooleanToWordsTimeOff(@sub_request.approved) %>
        </td>
      </tr>
      <% if @sub_request.processed_by_user_id %>
        <tr>
          <th>Processed By</th>
          <td>
              <%= link_to "#{@sub_request.processed_by_last_name},
                           #{@sub_request.processed_by_first_name}",
                           user_path(id: @sub_request.processed_by_user_id) %>
          </td>
        <tr>
          <th>Processed On</th>
          <td>
            <% if @sub_request.processed_on? %>
              <%= @sub_request.processed_on.strftime('%-m/%-d/%Y @ %I:%M%p') %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    <tr>
      <th>Date Submitted</th>
      <td><%= @sub_request.created_at.strftime('%-m/%-d/%Y @ %I:%M%p')%></td>
    </tr>
  </table>
</div>
